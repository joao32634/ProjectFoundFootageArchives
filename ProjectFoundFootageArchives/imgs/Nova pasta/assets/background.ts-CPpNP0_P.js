import{ax as G,as as Y,ay as $,az as Q,am as J,aA as K}from"./track-Io5XkqsL.js";const X=()=>{if(window.isOFDownloaderInjected)return;window.isOFDownloaderInjected=!0;const h=new Set,A=new Set,S=new Set;let k=!1,q=[];const C=t=>{const o=document.querySelector("#app");if(!o)return;const s=o.__vue__&&o.__vue__.showToast;s&&s(t)};function u(t,o){const s=t.querySelector("use"),e=s.href.baseVal;o?(t.setAttribute("disbaled","true"),s.setAttribute("href",e.replace("icon-download","icon-loading"))):(t.removeAttribute("disabled"),s.setAttribute("href",e.replace("icon-loading","icon-download")))}window.addEventListener("replyInvokeTasks",t=>{const{detail:o}=t;if(!o)return;const{type:s,options:e}=o;if(s==="alert"){typeof e=="object"&&e.buttons&&e.buttons.forEach(d=>{d.onclickEvent&&(e.onConfirm=()=>{const c=new CustomEvent("alertConfirm",{detail:{type:d.onclickEvent}});window.dispatchEvent(c)}),!d.onclick&&(d.onclick=()=>{})});const n={...e};delete n.message,window.interact(e.message,n)}s==="toast"&&C(e)});const L=new MutationObserver(t=>{for(const o of t){if(o.addedNodes)for(let s=0;s<o.addedNodes.length;s++){const e=o.addedNodes[s];if(e.classList&&e.classList.contains("b-chats__conversations-content")){const n=e.querySelector(".b-chat");n&&!k&&(k=!0,new MutationObserver(c=>{for(const r of c)if(r.addedNodes)for(let l=0;l<r.addedNodes.length;l++){const i=r.addedNodes[l];i.classList&&i.classList.contains("b-chat__item-message")&&i.querySelectorAll(".b-chat__message__content").forEach(E=>{S.add(E)}),i.parentElement&&i.parentElement.classList&&i.parentElement.classList.contains("b-chat__item-message")&&i.parentElement.querySelectorAll(".b-chat__message__content").forEach(E=>{S.add(E)})}S.forEach(r=>{U(r)})}).observe(n,{childList:!0,subtree:!0,attributes:!0}))}e.nodeType===Node.ELEMENT_NODE&&(e.classList&&e.classList.contains("b-post__wrapper")&&h.add(e),e.querySelectorAll&&(e.querySelectorAll(".b-post__wrapper").forEach(c=>h.add(c)),e.querySelector(".b-chats")||(k=!1)),e.classList&&(e.classList.contains("vue-recycle-scroller__item-view")||e.classList.contains("dynamic-scroller-item")||e.classList.contains("g-sides-gaps")||e.classList.contains("dynamic-scroller-item-homepage-feed")||e.classList.contains("b-profile__feed")||e.classList.contains("b-tabs__panel")||e.classList.contains("b-feed"))&&(e.querySelectorAll(".b-post__wrapper").forEach(d=>h.add(d)),e.parentNode&&e.parentNode.querySelectorAll(".b-post__wrapper").forEach(c=>h.add(c))))}if(o.type==="attributes"&&o.target.nodeType===Node.ELEMENT_NODE){const s=o.target;if(s.classList&&s.classList.contains("b-post__wrapper")&&h.add(s),s.classList&&(s.classList.contains("b-post__content")||s.classList.contains("m-post-has-media"))){const e=s.closest(".b-post__wrapper");e&&h.add(e)}s.classList&&s.classList.contains("pswp")&&A.add(s)}}h.forEach(o=>{var n,d;const s=((d=(n=o.querySelector(".g-user-username"))==null?void 0:n.textContent)==null?void 0:d.trim().substring(1))||"user_unknown",e=o.querySelector(".b-post__media__item-inner, div[at-attr='media_locator']");e&&(e.onclick=c=>{c.stopPropagation(),c.preventDefault();const r=e.__vue__&&e.__vue__._props;if(r){const l=r.post;q=N(l,s)}else q=[]}),B(o)}),A.forEach(o=>{F(o)})});function B(t){var D,y,b;if(t.querySelector("#feed-dl-btn"))return;const s=t.__vue__&&t.__vue__._props;if(s){const a=s.post,p=Reflect.has(a,"canViewMedia")?a.canViewMedia:!0,m=Reflect.has(a,"isMediaReady")?a.isMediaReady:!0,g=Reflect.has(a,"mediaCount")?a.mediaCount>0:Reflect.has(a,"media")?a.media.length>0:!1,w=Reflect.has(a,"linkedPosts")?(D=a.linkedPosts)==null?void 0:D.length:Reflect.has(a,"linkedUsers")?(y=a.linkedUsers)==null?void 0:y.length:!1,f=a.media.filter(x=>x.type==="video"&&!x.canView),v=f.reduce((x,P)=>x+P.duration,0),T=t.querySelector(".b-subscribe-block");if(T){if(T.querySelector(".b-subscribe-block__total-duration")||f.length<=1)return;const P=document.createElement("span");P.style.color="#00aef0",P.classList.add("b-subscribe-block__total-duration"),P.textContent=`Total ${M(v)}`,(b=T.querySelector(".b-purchase__list"))==null||b.appendChild(P);const W=R(f);T.appendChild(W)}if(w||!p||!m||!g){h.delete(t);return}}else{const a=t.querySelector(".b-post__content"),p=!!(a!=null&&a.querySelector(".b-post__unknown")),m=!!(a!=null&&a.querySelector(".m-not-allowed")),g=a==null?void 0:a.classList.contains("m-post-has-media");if(p||!g||m){h.delete(t);return}}const e=t.querySelectorAll(".b-post__tools");if(e.length===0)return;const n=e[e.length-1],d=n==null?void 0:n.querySelector(".b-post__tools__item.m-with-text-button"),c=d==null?void 0:d.cloneNode(!0);if(!c)return;const r=c.querySelector("button"),l=r.querySelector("svg"),i=l.querySelector("use"),_=i.getAttribute("href"),E=r.querySelector(".b-flexible-behavior__inside-text");r.id="feed-dl-btn",l.setAttribute("data-icon-name","icon-download"),i.setAttribute("href",_.replace("icon-funds","icon-download")),i.setAttribute("xlink:href",_.replace("icon-funds","icon-download")),E.innerText="DOWNLOAD",r.removeAttribute("disabled"),r.addEventListener("click",async a=>{var p,m;a.stopPropagation(),a.preventDefault();try{const g=((m=(p=t.querySelector(".g-user-username"))==null?void 0:p.textContent)==null?void 0:m.trim().substring(1))||"user_unknown";if(s){const w=N(s.post,g);u(r,!0),await V(w),u(r,!1)}else throw new Error("[OFDownloader] is not a vue component.")}catch{const w=t.querySelector(".b-post__date");w==null||w.getAttribute("href")}}),n==null||n.insertBefore(c,d==null?void 0:d.nextSibling),h.delete(t)}function N(t,o){const s=[],{id:e,responseType:n,media:d,text:c}=t,r="postedAt"in t?t.postedAt:"createdAt"in t?t.createdAt:"";for(const l of d){if(!l.canView)continue;const _=l.id,E=l.type,D=l.duration;if(l.files.drm){const b=l.files.drm.manifest.dash,a=l.files.drm.signature.dash;s.push({id:e,username:o,responseType:n,dateString:r,mid:_,mediaType:E,duration:D,url:b,signature:a,text:c})}else{const b=l.files.full.url,a=l.files.preview.url;if(!b&&!a)continue;const p=b?l.files.full.url:l.files.preview.url,m=l.files.full.width,g=l.files.full.height;s.push({id:e,username:o,responseType:n,dateString:r,mid:_,mediaType:E,duration:D,url:p,width:m,height:g,text:c})}}return s}async function F(t){var c;const o=t.querySelector("#pswp-dl-btn");if(o){const r=t.querySelector(".pswp__item[aria-hidden='false']");if(r){const l=r.querySelector("img"),i=r.querySelector("video");if(!l&&!i){t.removeChild(o),A.delete(t);return}}else{t.removeChild(o),A.delete(t);return}return}const s=(c=document.querySelector("link[rel='icon']"))==null?void 0:c.getAttribute("href");new URL(s).pathname.split("/").slice(0,-1).join("/");const e=document.createElement("button");e.classList.add("m-size-lg-hover","m-with-round-hover","g-btn","m-rounded","m-lg"),e.id="pswp-dl-btn",e.style.position="absolute",e.style.top="40px",e.style.left="40px",e.style.minWidth="fit-content",e.style.padding="16px";const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("g-icon","m-lg");const d=document.createElementNS("http://www.w3.org/2000/svg","use");d.setAttribute("href","#icon-download"),e.appendChild(n),n.appendChild(d),e.addEventListener("click",async r=>{var D,y,b,a;r.stopPropagation(),r.preventDefault();const l=document.querySelector(".pswp__item[aria-hidden='false']");if(!l)return;const i=l.querySelector("img"),_=l.querySelector("video");if(!i&&!_)return;const E=((y=(D=document.querySelector(".l-profile-container .g-user-username"))==null?void 0:D.textContent)==null?void 0:y.trim().substring(1))||((a=(b=document.querySelector(".b-chat__header__wrapper a"))==null?void 0:b.getAttribute("href"))==null?void 0:a.trim().substring(1))||"user_unknown";if(_){const p=_.__vue__&&_.__vue__._props;if(p){const m=p.media.id,g=q.find(w=>w.mid===m);if(g)u(e,!0),await V([g]),u(e,!1);else{const f=(T=>{const x=T.querySelectorAll("source");if(x.length===0)return null;const P=["original","1440","1080","720","480","240"];for(const W of P){const j=Array.from(x).find(z=>z.getAttribute("label")===W);if(j)return j.getAttribute("src")}return x[0].getAttribute("src")})(_);if(!f){alert("Media is DRM encrypted, download it via the desktop app.",{title:"OFDownloader: DRM Encrypted"});return}const v={id:crypto.randomUUID(),dateString:Date.now().toString(),mediaType:"video",url:f,mid:crypto.randomUUID(),username:E,responseType:"video"};u(e,!0),await V([v]),u(e,!1)}}}else if(i){const p=i.getAttribute("src"),m=q.find(g=>g.url===p);if(m)u(e,!0),await V([m]),u(e,!1);else{const g={id:crypto.randomUUID(),dateString:Date.now().toString(),mediaType:"photo",url:p,mid:crypto.randomUUID(),username:E,responseType:"photo"};u(e,!0),await V([g]),u(e,!1)}}else alert("Please copy the post link and contact us to support. Thank you.",{title:"OFDownloader: Incorrect media"})}),t.appendChild(e),A.delete(t)}function M(t){const o=Math.floor(t/3600),s=Math.floor(t%3600/60),e=t%60;return o>0?`${o}:${s}:${e}`:`${s}:${e}`}function R(t){const o=document.createElement("button");return o.classList.add("g-btn","m-rounded","post-subscribe-btn","m-uppercase","m-block","mt-1"),o.setAttribute("type","button"),o.textContent="More duration info",o.onclick=()=>{const s=t.filter(m=>!m.canView);if(s.length===0){alert("No preview videos available.",{title:"OFDownloader"});return}const e=document.querySelector("#of-duration-detail-modal");e&&e.remove();const n=document.createElement("div");n.id="of-duration-detail-modal",n.classList.add("modal","fade","show"),n.style.display="block",n.addEventListener("click",m=>{m.target===n&&n.remove()});const d=document.createElement("div");d.classList.add("modal-dialog","modal-dialog-centered","modal-md"),n.append(d);const c=document.createElement("div");c.classList.add("modal-content"),d.append(c);const r=document.createElement("header");r.classList.add("modal-header","g-border-bottom"),c.append(r);const l=document.createElement("h4");l.classList.add("modal-title"),l.textContent="Video details",r.append(l);const i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("l-sidebar__btn-close","m-with-round-hover","g-btn","m-with-round-hover","m-icon","m-icon-only","m-gray","m-sm-size");const _=document.createElementNS("http://www.w3.org/2000/svg","svg");_.classList.add("g-icon");const E=document.createElementNS("http://www.w3.org/2000/svg","use");E.setAttribute("href","#icon-close"),_.append(E),i.append(_),i.addEventListener("click",()=>n.remove()),r.append(i);const D=document.createElement("div");D.classList.add("modal-body"),c.append(D);const y=document.createElement("div");y.classList.add("w-100","mt-2"),y.style.maxHeight="260px",y.style.overflowY="auto",y.style.display="grid",y.style.gridTemplateColumns="repeat(3, minmax(0, 1fr))",y.style.rowGap="12px",y.style.columnGap="12px",y.style.alignItems="stretch",D.append(y);const b=(m,g,w)=>{const f=document.createElement("span");f.style.display="inline-flex",f.style.alignItems="center",f.style.columnGap="10px",f.style.padding="6px 12px 6px 6px",f.style.borderRadius="999px",f.style.backgroundColor="rgba(0, 174, 240, 0.16)",f.style.color="#00aef0",f.style.fontSize="12px",f.style.fontWeight="600",f.style.width="100%",f.style.minHeight="32px";const v=document.createElement("span");v.textContent=`${m}`,v.style.display="inline-flex",v.style.alignItems="center",v.style.justifyContent="center",v.style.width="24px",v.style.height="24px",v.style.borderRadius="50%",v.style.backgroundColor="#00aef050",v.style.color="#fff",v.style.fontWeight="600",v.style.fontSize="12px";const T=document.createElement("span");T.textContent=g,T.style.color="#6c757d",T.style.fontWeight="400",T.style.fontSize="11px",T.style.marginInlineStart="auto";const x=document.createElement("span");return x.textContent=w,x.style.color="#00aef0",x.style.fontWeight="700",x.style.fontSize="14px",x.style.marginInline="auto",f.append(v,x,T),f};s.forEach((m,g)=>{const w=b(g+1,H(m),M(m.duration));y.append(w)});const a=document.createElement("footer");a.classList.add("modal-footer","g-border-top","justify-content-end"),c.append(a);const p=document.createElement("button");p.classList.add("g-btn","m-flat","m-btn-gaps","m-reset-width"),p.textContent="Close",p.addEventListener("click",()=>n.remove()),a.append(p),document.body.append(n)},o}function H(t){var e,n;const o=t.videoSources?Object.keys(t.videoSources):[];if(o.length){const d=o.map(c=>Number.parseInt(c,10)).filter(c=>!Number.isNaN(c)).sort((c,r)=>r-c)[0];if(d)return`${d}p`}const s=(n=(e=t.files)==null?void 0:e.full)==null?void 0:n.height;return s?`${s}p`:"-"}function U(t){var D;const o=t.parentElement;if(o&&o.classList&&o.classList.contains("m-not-paid-yet")){if(o.querySelector("#b-purchase__list-item__total-duration"))return;const b=o.__vue__;if(b){b.photos;const a=b.videos,p=a.filter(m=>!m.canView);if(p.length>1){const m=t.querySelector(".b-purchase__list");if(m){const w=a.reduce((v,T)=>v+T.duration,0),f=document.createElement("span");f.style.color="#00aef0",f.classList.add("b-purchase__list-item__count"),f.id="b-purchase__list-item__total-duration",f.textContent=`Total ${M(w)}`,m.appendChild(f)}const g=t.querySelector(".b-subscribe-block");if(g){const w=R(p);g.appendChild(w)}}}}if(t.querySelector(".chat-dl-btn"))return;const e=t.querySelector(".b-post__media__item-inner, div[at-attr='media_locator']");if(!e)return;const n=e.__vue__&&e.__vue__._props;if(n&&!(Reflect.has(n.message,"media")&&n.message.media.some(b=>Reflect.has(b,"canView")?b.canView:!0)))return;const d=e.classList.contains("m-video"),c=e.classList.contains("m-gif"),r=e.classList.contains("m-photo");if(!d&&!c&&!r)return;const l=(D=document.querySelector("link[rel='icon']"))==null?void 0:D.getAttribute("href");new URL(l).pathname.split("/").slice(0,-1).join("/");const i=document.createElement("button");i.classList.add("m-with-round-hover","g-btn","m-rounded","chat-dl-btn"),i.style.position="absolute",i.style.bottom="0",i.style.right="-60px",i.style.minWidth="fit-content";const _=document.createElementNS("http://www.w3.org/2000/svg","svg");_.classList.add("g-icon");const E=document.createElementNS("http://www.w3.org/2000/svg","use");E.setAttribute("href","#icon-download"),i.appendChild(_),_.appendChild(E),t.appendChild(i),i.addEventListener("click",async y=>{var b,a;y.stopPropagation(),y.preventDefault();try{const p=[],m=((a=(b=t.querySelector(".g-avatar"))==null?void 0:b.getAttribute("href"))==null?void 0:a.trim().substring(1))||"user_unknown";if(n){const g=n.entityType;if(g==="post"){const w=n.post;p.push(...N(w,m))}if(g==="message"){const w=n.message;p.push(...N(w,m))}u(i,!0),await V(p),u(i,!1)}}catch{}}),S.delete(t)}function O(){document.querySelectorAll(".b-post__wrapper").forEach(o=>B(o))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):O(),L.observe(document.body,{attributes:!0,attributeFilter:["class","style"],childList:!0,subtree:!0});async function V(t){return new Promise(o=>{try{const s=new CustomEvent("invokeTasks",{detail:t});window.dispatchEvent(s);const e=()=>{window.removeEventListener("taskProcessed",e),o()};window.addEventListener("taskProcessed",e)}catch{alert("Please try again later, or contact support.")}})}},Z=()=>{const h="DAILY_TIMESTAMP";return chrome.storage.local.get(h).then(A=>{const S=A[h];let k=Date.now();if(S&&!(new Date(k).getDay()>new Date(S).getDay()))return;const q=document.querySelector("#diff-modal");if(q){q.classList.add("show");return}chrome.storage.local.set({[h]:k});const C=new DOMParser,u=document.createDocumentFragment(),L=document.createElement("div");L.classList.add("modal","fade","show"),L.id="diff-modal",u.append(L);const B=document.createElement("div");B.classList.add("modal-dialog","modal-lg","modal-dialog-centered"),L.append(B);const N=document.createElement("div");N.classList.add("modal-content"),B.append(N);const F=document.createElement("header");F.classList.add("modal-header","g-border-bottom"),N.append(F);const M=document.createElement("h4");M.classList.add("modal-title","d-flex","align-items-center"),M.textContent="Onlyfans Downloader",F.append(M);const R=`
      <div class="g-avatar g-icon has-story mr-1">
      <div data-v-78bd6e0d class="g-avatar__img-wrapper">
        <img style="width: 100%;" src="${chrome.runtime.getURL("src/assets/ofol/icon48.png")}"/>
      </div>
      </div>
    `;M.prepend(C.parseFromString(R,"text/html").body.firstElementChild);const U=C.parseFromString(`
    <button data-v-583fb90a type="button" at-attr="close_btn" class="l-sidebar__btn-close m-with-round-hover g-btn m-with-round-hover m-icon m-icon-only m-gray m-sm-size">
      <svg data-v-583fb90a="" class="g-icon" data-icon-name="icon-close" aria-hidden="true">
        <use href="/theme/onlyfans/spa/icons/sprite.svg?rev=202306261027-6fa8a11695#icon-close" xlink:href="/theme/onlyfans/spa/icons/sprite.svg?rev=202306261027-6fa8a11695#icon-close"></use>
      </svg>
    </button>
    `,"text/html").body.firstElementChild;U.addEventListener("click",()=>L.classList.remove("show")),F.append(U);const O=document.createElement("div");N.id="",O.classList.add("modal-body","d-flex","flex-row"),N.append(O),O.append(C.parseFromString(`
      <div class="px-3" style="width: 100%;">
        <h4 class="text-center">Free Version</h4>
        <ul class="gray-list px-4">
          <p>✔️ ≤ 2 Videos</p>
          <p>✔️ ≤ 10 Photos</p>
        </ul>
      </div>
    `,"text/html").body.firstElementChild),O.append(C.parseFromString(`
      <div class="px-3" style="width: 100%;">
        <h4 class="text-center">Pro Version</h4>
        <ul class="gray-list px-4">
          <p>✅ Unlimit Videos</p>
          <p>✅ Unlimit Photos</p>
          <p>✅ Download Messages Content</p>
          <p>✅ Support Time Period Download</p>
        </ul>
      </div>
    `,"text/html").body.firstElementChild);const o=document.createElement("footer");o.classList.add("modal-footer","g-border-top","justify-content-around"),N.append(o);const s=document.createElement("button");s.classList.add("g-btn","m-flat","m-btn-gaps","m-reset-width"),s.textContent="Use Free Version",s.addEventListener("click",()=>L.classList.remove("show")),o.append(s);const e=document.createElement("button");e.classList.add("g-btn","m-rounded","m-reset-width"),e.textContent="UPGRADE NOW!!",e.addEventListener("click",()=>{chrome.runtime.sendMessage({command:"ToSubscription"}),L.classList.remove("show")}),o.append(e),document.body.append(u)})};G();chrome.runtime.onMessage.addListener((h,A,S)=>{const{command:k,payload:q}=h;let C=!1;if(k==="ToSubscription"&&chrome.storage.local.get("userState").then(({userState:u})=>{u=u?typeof u=="string"?JSON.parse(u):u:{},u.token&&u.token!==""?$("/subscribe"):Y({next:"/subscribe"})}),k==="Download"){const{url:u,filename:L}=q;chrome.downloads.download({url:u,filename:L})}return k==="ToHomesite"&&chrome.tabs.create({url:"https://hlsdownloader.com/"}),k==="updateQuota"&&(C=!0,Q().then(u=>S(u)).catch(()=>S(!1))),C});let I=[];chrome.tabs.onUpdated.addListener(async(h,A,S)=>{var k,q,C,u;try{const L=await chrome.tabs.get(h);if(!(L!=null&&L.active)||(A.status==="complete"&&((k=S.url)==null?void 0:k.indexOf("onlyfans.com"))!==-1&&await chrome.scripting.executeScript({target:{tabId:h},func:X,world:"MAIN"}),(q=J.value)!=null&&q.isPro)||!((C=await chrome.cookies.get({url:"https://onlyfans.com",name:"auth_id"}))==null?void 0:C.value))return;if(A.status==="complete"&&((u=S.url)!=null&&u.includes("onlyfans.com"))){if(I.includes(h))return;try{await chrome.scripting.executeScript({target:{tabId:h},func:Z}),I.push(h)}catch{I=I.filter(M=>M!==h)}}}catch{}});chrome.runtime.onInstalled.addListener(async h=>{h.reason==chrome.runtime.OnInstalledReason.INSTALL&&(chrome.tabs.create({url:"https://hlsdownloader.com/",active:!1}).then(async A=>{const S=await chrome.scripting.executeScript({target:{tabId:A.id},func:()=>({utm_source:localStorage.getItem("utm_source"),gclid:localStorage.getItem("gclid")})});if(chrome.tabs.remove(A.id),S[0].result){const{utm_source:k,gclid:q}=S[0].result;await chrome.storage.local.set({source:k,gclid:q})}await K()}),$("/"))});chrome.action.onClicked.addListener(()=>{$("/")});
